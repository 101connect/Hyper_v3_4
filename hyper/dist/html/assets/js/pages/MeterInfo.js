var GlobalTimer;function GetSystemSettings(){$.get("get_system_settings",function(e){var t=e.split(";"),n=0;document.getElementById("DemandInterval").value=t[n++],document.getElementById("DemandSubInt").value=t[n++],"15172"===t[n++]?document.getElementById("PointMap").value="Schneider Point Map":document.getElementById("PointMap").value="Core Module Point Map",1==parseInt(t[n++].valueOf(),10)?(document.getElementById("dhcpenable").checked=!0,document.getElementById("manualconfig").checked=!1):(document.getElementById("dhcpenable").checked=!1,document.getElementById("manualconfig").checked=!0),document.getElementById("IPV4ADDRESS").value=t[n++],document.getElementById("IPV4MASK").value=t[n++],document.getElementById("IPV4GATEWAY").value=t[n++],document.getElementById("IPV4DNS1").value=t[n++];var d=t[n++],c=t[n++];document.getElementById("IPV4NTP").value=""===c?d:c,document.getElementById("BACnetPort").value=t[n++],document.getElementById("BACnetID").value=t[n++],document.getElementById("BACnetVirtNet").value=t[n++],document.getElementById("SERIALADDRESS").value=t[n++],document.getElementById("BaudRate").value=t[n++];var o=t[n++]/1e3;document.getElementById("ptratio").value=o.toFixed(1),document.getElementById("overvoltthreshold").value=t[n++],document.getElementById("overvolttimedelay").value=t[n++],document.getElementById("undervoltthreshold").value=t[n++],document.getElementById("undervolttimedelay").value=t[19]})}function SetSystemSettings(){var e=new XMLHttpRequest,t=document.getElementById("DemandInterval").value+"&";t+=document.getElementById("DemandSubInt").value+"&","Schneider Point Map"===document.getElementById("PointMap").value?t+="15172&":t+="22000&",e.open("POST","setsystemsettings",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(t)}function GetGeneralSettings(){var n=new XMLHttpRequest;n.onreadystatechange=function(){var e,t;4==n.readyState&&200==n.status&&(e=n.responseText.split(";"),t=0,document.getElementById("DemandInterval").value=e[t++],document.getElementById("DemandSubInt").value=e[t++],"15172"===e[t++]?document.getElementById("PointMap").value="Schneider Point Map":document.getElementById("PointMap").value="Core Module Point Map","0"===e[t]?document.getElementById("SPConfig1").value="Top Feed":"1"===e[t]?document.getElementById("SPConfig1").value="Bottom Feed":"2"===e[t]?document.getElementById("SPConfig1").value="Inline Sequential":"3"===e[t]?document.getElementById("SPConfig1").value="Inline Odd/Even":document.getElementById("SPConfig1").value="Sequential","0"===e[++t]?document.getElementById("SPConfig2").value="Top Feed":"1"===e[t]?document.getElementById("SPConfig2").value="Bottom Feed":"2"===e[t]?document.getElementById("SPConfig2").value="Inline Sequential":"3"===e[t]?document.getElementById("SPConfig2").value="Inline Odd/Even":document.getElementById("SPConfig2").value="Sequential")},n.open("GET","get_general_settings",!0),n.send()}function SetGeneralSettings(){var e=new XMLHttpRequest,t=document.getElementById("DemandInterval").value+"&";t+=document.getElementById("DemandSubInt").value+"&","Schneider Point Map"===document.getElementById("PointMap").value?t+="15172&":t+="22000&","Top Feed"===document.getElementById("SPConfig1").value?t+="0&":"Bottom Feed"===document.getElementById("SPConfig1").value?t+="1&":"Inline Sequential"===document.getElementById("SPConfig1").value?t+="2&":"Inline Odd/Even"===document.getElementById("SPConfig1").value?t+="3&":t+="4&","Top Feed"===document.getElementById("SPConfig2").value?t+="0&":"Bottom Feed"===document.getElementById("SPConfig2").value?t+="1&":"Inline Sequential"===document.getElementById("SPConfig2").value?t+="2&":"Inline Odd/Even"===document.getElementById("SPConfig2").value?t+="3&":t+="4&",e.open("POST","setgeneral",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(t)}function SetDate(){var e=new Date,t="TIME=",n=e.getHours();t+=n+"&",t+=e.getMinutes()+"&",t+=e.getSeconds()+"&",t+=e.getDate()+"&",t+=e.getMonth()+"&",t+=e.getFullYear()-1900+"&";var d=new XMLHttpRequest;d.open("POST","settime",!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&$.get("get_main_info",function(e){var t=e.split(";"),n=0;document.getElementById("devmodel").innerHTML=t[n++],document.getElementById("devname").innerHTML=t[n++],document.getElementById("devlocation").innerHTML=t[n++],document.getElementById("firmwareversion").innerHTML=t[n++],document.getElementById("date").innerHTML=t[n++],document.getElementById("MAC").innerHTML=t[5]})},d.send(t)}function GetNetConfig(){var t=new XMLHttpRequest;t.onreadystatechange=function(){var e;4==t.readyState&&200==t.status&&(e=t.responseText.split(";"),document.getElementById("IPV4ADDRESS").value=e[1].valueOf(),document.getElementById("IPV4MASK").value=e[2].valueOf(),document.getElementById("IPV4GATEWAY").value=e[3].valueOf(),document.getElementById("IPV4DNS1").value=e[4].valueOf(),1==parseInt(e[0].valueOf(),10)?(document.getElementById("dhcpenable").checked=!0,document.getElementById("manualconfig").checked=!1):(document.getElementById("dhcpenable").checked=!1,document.getElementById("manualconfig").checked=!0))},t.open("GET","get_network_settings",!0),t.send()}function SendNetUpdate(){var e=1==document.getElementById("dhcpenable").checked?"1":"0",t="sysconfig=sysconfig&";t+="DHCP="+e+"&",t+="IPV4ADDRESS="+document.getElementById("IPV4ADDRESS").value+"&",t+="IPV4MASK="+document.getElementById("IPV4MASK").value+"&",t+="IPV4GATEWAY="+document.getElementById("IPV4GATEWAY").value+"&",t+="IPV4DNS1="+document.getElementById("IPV4DNS1").value+"&",t+="IPV4NTP="+document.getElementById("IPV4NTP").value+"&";var n=new XMLHttpRequest;n.open("POST","ethernet",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),document.getElementById("UpdateStatusBack").innerHTML=t.length,n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(document.getElementById("UpdateStatusBack").innerHTML=n.responseText)},n.send(t)}function GetMainInfo(){var d=new XMLHttpRequest;d.onreadystatechange=function(){var e,t,n;4==d.readyState&&200==d.status&&(e=d.responseText.split(";"),t=0,document.getElementById("devmodel").innerHTML=e[t++].valueOf(),document.getElementById("devname").innerHTML=e[t++].valueOf(),document.getElementById("devlocation").innerHTML=e[t++].valueOf(),document.getElementById("firmwareversion").innerHTML=e[t++].valueOf(),document.getElementById("date").innerHTML=e[t++].valueOf(),document.getElementById("MAC").innerHTML=e[t++].valueOf(),$(".progress-bar").css("background-color","#E2E3E0").text(""),"TRUE"===e[6]&&(n=100*(1-e[8]/e[7]),$(".progress-bar").css("background-color","blue"),$(".progress-bar").css("width",n+"%").text(n.toFixed(1)+" %")),update_sp_status(e[9],1,Number(e[13])),update_sp_status(e[10],2,Number(e[14])),update_sp_status(e[11],3,Number(e[15])),update_sp_status(e[12],4,Number(e[16])))},d.open("GET","get_main_info",!0),d.send()}function update_sp_status(e,t,n){switch(t){case 1:var d="#SP1Status";break;case 2:d="#SP2Status";break;case 3:d="#SP3Status";break;case 4:d="#SP4Status"}switch(e){case"0":$(d).css({color:"grey","font-size":"100%"}).text("NOTHING_CONNECTED");break;case"1":switch($(d).css({color:"green","font-size":"100%"}).text("CONNECTED"),n){case 1:case 2:default:document.getElementById("SP1image").src="card.PNG"}break;case"2":$(d).css({color:"red","font-size":"100%"}).text("OFFLINE");break;case"3":$(d).css({color:"blue","font-size":"100%"}).text("INVALID")}}function serialchange(){var e,t="sysconfig=sysconfig&";t+="SERIALADDRESS="+document.getElementById("SERIALADDRESS").value+"&",t+="DIPENABLEON="+(e=1==document.getElementById("DIPENABLEON").checked?1:0)+"&",1==document.getElementById("BAUD9600").checked&&(e=9600),1==document.getElementById("BAUD19200").checked&&(e=19200),1==document.getElementById("BAUD38400").checked&&(e=38400),1==document.getElementById("BAUD57600").checked&&(e=57600),1==document.getElementById("BAUD76800").checked&&(e=76800),t+="BAUDRATE="+e+"&",1==document.getElementById("PARITYNONE").checked&&(e=0),1==document.getElementById("PARITYODD").checked&&(e=1),1==document.getElementById("PARITYEVEN").checked&&(e=2),t+="PARITY="+e+"&",t+="STOPBITS="+(e=1==document.getElementById("STOPBITSONE").checked?1:2)+"&";var n=new XMLHttpRequest;n.open("POST","serial",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),document.getElementById("UpdateStatusBack").innerHTML=t.length,n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(document.getElementById("UpdateStatusBack").innerHTML=n.responseText)},n.send(t)}function GetSerialSettings(){var t=new XMLHttpRequest;document.getElementById("STOPBITSTWO").disabled=!0,document.getElementById("PARITYODD").disabled=!0,document.getElementById("PARITYEVEN").disabled=!0,t.onreadystatechange=function(){var e;4==t.readyState&&200==t.status&&(e=t.responseText.split(";"),document.getElementById("SERIALADDRESS").value=e[0].valueOf(),"9600"==e[1].valueOf()&&(document.getElementById("BAUD9600").checked=!0,document.getElementById("BAUD19200").checked=!1,document.getElementById("BAUD38400").checked=!1,document.getElementById("BAUD57600").checked=!1,document.getElementById("BAUD76800").checked=!1),"19200"==e[1].valueOf()&&(document.getElementById("BAUD9600").checked=!1,document.getElementById("BAUD19200").checked=!0,document.getElementById("BAUD38400").checked=!1,document.getElementById("BAUD57600").checked=!1,document.getElementById("BAUD76800").checked=!1),"38400"==e[1].valueOf()&&(document.getElementById("BAUD9600").checked=!1,document.getElementById("BAUD19200").checked=!1,document.getElementById("BAUD38400").checked=!0,document.getElementById("BAUD57600").checked=!1,document.getElementById("BAUD76800").checked=!1),"57600"==e[1].valueOf()&&(document.getElementById("BAUD9600").checked=!1,document.getElementById("BAUD19200").checked=!1,document.getElementById("BAUD38400").checked=!1,document.getElementById("BAUD57600").checked=!0,document.getElementById("BAUD76800").checked=!1),"76800"==e[1].valueOf()&&(document.getElementById("BAUD9600").checked=!1,document.getElementById("BAUD19200").checked=!1,document.getElementById("BAUD38400").checked=!1,document.getElementById("BAUD57600").checked=!1,document.getElementById("BAUD76800").checked=!0),0==parseInt(e[2].valueOf(),10)&&(document.getElementById("PARITYNONE").checked=!0,document.getElementById("PARITYODD").checked=!1,document.getElementById("PARITYEVEN").checked=!1),1==parseInt(e[2].valueOf(),10)&&(document.getElementById("PARITYNONE").checked=!1,document.getElementById("PARITYODD").checked=!0,document.getElementById("PARITYEVEN").checked=!1),2==parseInt(e[2].valueOf(),10)&&(document.getElementById("PARITYNONE").checked=!1,document.getElementById("PARITYODD").checked=!1,document.getElementById("PARITYEVEN").checked=!0),1==parseInt(e[3].valueOf(),10)&&(document.getElementById("STOPBITSONE").checked=!0,document.getElementById("STOPBITSTWO").checked=!1),2==parseInt(e[3].valueOf(),10)&&(document.getElementById("STOPBITSONE").checked=!1,document.getElementById("STOPBITSTWO").checked=!0),0==parseInt(e[4].valueOf(),10)&&(document.getElementById("DIPENABLEOFF").checked=!0,document.getElementById("DIPENABLEON").checked=!1,EnableAddr()),1==parseInt(e[4].valueOf(),10)&&(document.getElementById("DIPENABLEOFF").checked=!1,document.getElementById("DIPENABLEON").checked=!0,DisableAddr()))},t.open("GET","get_serial_settings",!0),t.send()}function EnableAddr(){document.getElementById("SERIALADDRESS").disabled=!1}function DisableAddr(){document.getElementById("SERIALADDRESS").disabled=!0}function eth2settings(){1==document.getElementById("eth2enable").checked?(document.getElementById("eth2enable").checked=!0,document.getElementById("eth2disable").checked=!1,document.getElementById("IPV4ADDRESS2").disabled=!1,document.getElementById("IPV4MASK2").disabled=!1,document.getElementById("IPV4GATEWAY2").disabled=!1):(document.getElementById("eth2enable").checked=!1,document.getElementById("eth2disable").checked=!0,document.getElementById("IPV4ADDRESS2").disabled=!0,document.getElementById("IPV4MASK2").disabled=!0,document.getElementById("IPV4GATEWAY2").disabled=!0)}function ITICFormDL(I){var i=document.getElementById("cmbemafilelist").value,e=new XMLHttpRequest;e.open("POST","wavefilename",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&$.get("dlcbema",function(e){if("TRUE"===I){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",i),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else{for(var n,d,c,o=e.split(";"),a=0,m=0,l=document.getElementById("TableData"),u="";a++<o.length-1;){for(u+="<tr>",j=0;j<6;j++)id="tdval"+m,m++,u+='<td  align="center" id="'+id+'" ></td>';u+="</tr>"}for(l.innerHTML=u,m=a=0;a++<o.length;){var s=o[a-1].split(",");for(j=0;j<6;j++)n=0==j&&1<a?(d=1e3*s[j],(c=new Date(d)).toLocaleDateString()+" "+c.toLocaleTimeString()):s[j],id="tdval"+m,m++,document.getElementById(id).innerHTML=n}}})},e.send(i)}function ITICShowData(){ITICFormDL("FALSE")}function ITICDLData(){ITICFormDL("TRUE")}function CBEMAFileList(){$("#cmbemafilelist").children().remove();var e=document.getElementById("cmbemafilelist"),t=document.createElement("option");t.text="cbema.csv",e.add(t),ITICShowData()}function UpdateFirmware(){document.getElementById("upload-status").innerHTML="",document.getElementById("progress").innerHTML="",document.getElementById("result").innerHTML="";var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){var e=t.responseText.split(";");if("No USB Flash Drive Found"===e[0])return void(document.getElementById("upload-status").innerHTML="Insert USB Flash Drive");if("No Firmware Image Found"===e[0])return void(document.getElementById("upload-status").innerHTML="Can't Find iMMC.bch on USB Flash Drive");document.getElementById("upload-status").innerHTML=e[0]}},t.open("GET","fw_update",!0),t.send(),document.getElementById("upload-status").innerHTML="Starting Firmware Update, do not turn off power to the device!",GlobalTimer=60;setInterval(FW_UpateStatus,1e3);setTimeout(function(){window.location.replace("main.html")},6e4)}function FW_UpateStatus(){GlobalTimer--,document.getElementById("progress").innerHTML=GlobalTimer+" Seconds Remaing"}function SystemReset(){var e=new XMLHttpRequest;e.open("GET","sr_update",!0),e.send(),setTimeout(function(){window.location.replace("main.html")},3e4)}function SaveSettingsToUSB(){var t=new XMLHttpRequest;t.onreadystatechange=function(){var e;4==t.readyState&&200==t.status&&(e=t.responseText.split(";"),$.get("dlsettings",function(e){var t;";No USB Found"!==e?""!==e&&((t=document.createElement("a")).setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","config.csv"),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)):document.getElementById("SaveSettingsStatusBack").innerHTML="Insert USB Flash Drive"}),document.getElementById("SaveSettingsStatusBack").innerHTML=e[0])},t.open("GET","write_settings",!0),t.send()}